webpackJsonp([1],{"2b63":function(t,e){},"7nOq":function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("7+uW"),s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("transition",{attrs:{name:"fade"}},[e("router-view")],1)],1)},staticRenderFns:[]};var o=a("VU/8")({name:"App"},s,!1,function(t){a("huGD")},null,null).exports,r=a("/ocq"),n=a("mvHQ"),l=a.n(n),c=a("mtWM"),d=a.n(c),u={data:function(){return{stories:null,fullscreenLoading:!1,todayText:"",dateText:"",scrollPosition:0}},methods:{getNumberOfCacheBefore:function(t){var e=new Date(t.slice(0,4),t.slice(4,-2)-1,t.slice(6));return e.setDate(e.getDate()+1),this.getNumberOfDate(e)},getNumberOfDate:function(t){var e=t.getMonth()+1,a=t.getDate();return t.getFullYear()+""+(e<10?"0"+e:e)+(a<10?"0"+a:a)},getFullFromApi:function(){var t=localStorage.getItem("daily_cache"),e=JSON.parse(t);if(t&&this.getNumberOfCacheBefore(e.date)===this.dateText)this.stories=e.stories;else{var a=this;a.fullscreenLoading=!0;var i={stories:{}};d.a.get("https://api.mou.science/daily/api/4/news/before/"+this.dateText).then(function(t){i.date=t.data.date;var e=[];t.data.stories.forEach(function(t){var a=t.id;i.stories[a]={},i.stories[a].info=t;var s="https://api.mou.science/daily/api/4/news/"+a;e.push(d.a.get(s))}),d.a.all(e).then(function(t){t.forEach(function(t){i.stories[t.data.id].content=t.data}),console.log("today: "+(a.todayText===a.dateText)),a.todayText===a.dateText?d.a.get("https://api.mou.science/daily/api/4/news/latest").then(function(t){i.date=t.data.date;var e=[];t.data.stories.forEach(function(t){var a=t.id;if(!i.stories[a]){i.stories[a]={},i.stories[a].info=t;var s="https://api.mou.science/daily/api/4/news/"+a;e.push(d.a.get(s))}}),d.a.all(e).then(function(t){t.forEach(function(t){i.stories[t.data.id].content=t.data}),a.stories=i.stories,localStorage.setItem("daily_cache",l()(i)),a.fullscreenLoading=!1})}):(a.stories=i.stories,localStorage.setItem("daily_cache",l()(i)),a.fullscreenLoading=!1)})}).catch(function(t){a.fullscreenLoading=!1,a.$message({showClose:!0,message:"加载失败，请重试。",duration:0,type:"error"}),console.log(t)})}},readsStory:function(t){this.changeRouter("/article/"+t)},getTodayData:function(){this.dateText=this.todayText,this.getFullFromApi()},handleDateChange:function(t){this.getFullFromApi()},changeRouter:function(t){console.log($(window).scrollTop()),sessionStorage.setItem("home_pos",$(window).scrollTop()),this.$router.push(t)}},mounted:function(){var t=new Date;this.todayText=this.getNumberOfDate(t);var e=new Date;e.setDate(e.getDate()-1);var a=this.getNumberOfDate(e);console.log(this.todayText);var i=localStorage.getItem("daily_cache"),s=JSON.parse(i);if(i){if(i){var o=this.getNumberOfCacheBefore(s.date);this.dateText=o,this.todayText===o||a===o&&t.getHours()<6?this.stories=s.stories:(this.stories=s.stories,this.$notify({title:"注意：",message:"此缓存非今天的日报，戳此通知可更新。",onClick:this.getTodayData,duration:2888}))}}else this.getFullFromApi();setTimeout(function(){$(window).scrollTop(parseInt(sessionStorage.getItem("home_pos")))},100)}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-header",{staticStyle:{padding:"0",height:"38px",width:"100%",position:"fixed",top:"0","z-index":"1000"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{md:15}},[a("div",{staticClass:"head"},[a("el-col",{attrs:{span:12}},[a("h5",{staticStyle:{"text-align":"center","margin-top":"6px","font-weight":"inherit"}},[t._v("知乎日报")])]),t._v(" "),a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small",type:"date",format:"yyyy-MM-dd","value-format":"yyyyMMdd",placeholder:"选择日期",editable:!1,clearable:!1},on:{change:t.handleDateChange},model:{value:t.dateText,callback:function(e){t.dateText=e},expression:"dateText"}})],1)],1)])],1)],1),t._v(" "),a("el-main",{staticStyle:{"padding-left":"15px","padding-right":"15px","padding-top":"48px"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{md:{span:14}}},[a("el-row",{attrs:{gutter:30}},t._l(t.stories,function(e){return a("el-col",{key:e.id,attrs:{span:12,md:6,sm:8}},[a("el-card",{attrs:{"body-style":{padding:"0px"}}},[a("img",{staticClass:"image",attrs:{src:e.content.image.replace(/(https|http):\/\/(.*?)/g,"https://images.weserv.nl/?url=$2")},on:{click:function(a){t.readsStory(e.info.id)}}}),t._v(" "),a("div",{staticStyle:{padding:"14px"},on:{click:function(a){t.readsStory(e.info.id)}}},[a("span",{staticClass:"article-title"},[t._v(t._s(e.info.title))]),t._v(" "),a("div",{staticClass:"bottom clearfix"},[a("time",{staticClass:"time"},[t._v("id: "+t._s(e.info.id))])])])]),t._v(" "),a("br")],1)}))],1)],1)],1),t._v(" "),a("el-row",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-text":"加载中......"}})],1)},staticRenderFns:[]};var p=a("VU/8")(u,h,!1,function(t){a("2b63")},null,null).exports,g={data:function(){return{currentStory:{body:"",img_source:"",image:"",viewMore:"",title:""},currentStoryId:"",clickCount:0,clickTimer:null,errorMessage:"",fullscreenLoading:!1}},methods:{getContent:function(t){setTimeout(function(){$(window).scrollTop(0)},100);var e=localStorage.getItem("daily_cache"),a=JSON.parse(e);if(e){var i=null;i=a.stories[t].content,this.currentStory.body=i.body.replace(/<img class="content-image" src="(https|http):\/\/(.*?)"/g,'<img class="content-image" src="https://images.weserv.nl/?url=$2"').replace('<div class="img-place-holder"></div>','<div class="img-place-holder" style="height: auto;"><div class="img-wrap">\n<h1 class="headline-title">'+i.title+'</h1>\n<span class="img-source">'+i.image_source+'</span>\n<img src="'+i.image.replace(/(https|http):\/\/(.*?)/,"https://images.weserv.nl/?url=$2")+'" alt="">\n<div class="img-mask"></div>\n</div></div>'),this.currentStory.img_source=i.image_source,this.currentStory.title=i.title,this.currentStory.image=i.image;var s=i.body.match(/class="view-more"><a href="(.+?)">/);this.currentStory.viewMore=s?s[1]:"#","false"!==localStorage.getItem("daily_vue_first_use")&&(this.$notify({title:"操作提示：",message:"1.双击随机一篇文章， 2.点击左上角“知乎日报”可返回列表， 3.浏览器后退有效， 4.数据已存储到本地，日期变化时重新加载， 5.查看非当天日报请使用后退返回，点击左上角会重载当天数据。",duration:0}),localStorage.setItem("daily_vue_first_use","false"))}},backToTop:function(){$("html,body").animate({scrollTop:0},400)},articleClick:function(){if(this.clickCount++,1===this.clickCount){var t=this;this.clickTimer=setTimeout(function(){t.clickCount=0},700)}else this.randomArticle(),clearTimeout(this.clickTimer),this.clickCount=0},backHome:function(){this.$router.push({path:"/"})},randomArticle:function(){var t=localStorage.getItem("daily_cache"),e=JSON.parse(t);if(t){var a=[];for(var i in e.stories)a.push(i);var s=a[Math.floor(Math.random()*a.length)];this.$router.push({path:"/article/"+s})}}},watch:{$route:function(){var t=this;this.currentStoryId="",setTimeout(function(){t.currentStoryId=t.$route.params.aid},300),this.getContent(this.$route.params.aid)}},mounted:function(){this.currentStoryId=this.$route.params.aid,this.getContent(this.$route.params.aid)}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-header",{staticStyle:{padding:"0",height:"38px",width:"100%",position:"fixed",top:"0","z-index":"1000"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{md:15}},[a("div",{staticClass:"head"},[a("el-col",{attrs:{span:12}},[a("h5",{staticStyle:{"text-align":"center","margin-top":"6px","font-weight":"inherit"},on:{click:t.backHome}},[t._v("知乎日报")])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("table",{staticStyle:{height:"100%","margin-top":"5px"}},[a("tr",[a("td",[a("a",{staticStyle:{color:"black","text-decoration":"underline"},attrs:{target:"_blank",href:t.currentStory.viewMore}},[t._v("查看问题")])])])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{staticStyle:{width:"100%","background-color":"transparent",border:"none"},on:{click:t.randomArticle}},[a("span",{staticClass:"el-icon-arrow-right"})])],1)],1)])],1)],1),t._v(" "),a("div",{staticStyle:{"margin-top":"21px",padding:"15px"}},[a("div",{staticClass:"row"},[a("transition",{attrs:{name:"fade"}},[t.currentStoryId?a("div",{staticClass:"col-12",on:{click:t.articleClick}},[a("div",{domProps:{innerHTML:t._s(t.currentStory.body)}}),t._v(" "),a("el-button",{staticClass:"back-to-top",attrs:{size:"small"},on:{click:t.backToTop}},[t._v("To top")])],1):t._e()])],1)])],1)},staticRenderFns:[]};var f=a("VU/8")(g,m,!1,function(t){a("7nOq")},null,null).exports;i.default.use(r.a);var v=new r.a({routes:[{path:"/",name:"Home",component:p},{path:"/article/:aid",name:"Article",component:f}]}),y=a("zL8q"),_=a.n(y);a("tvR6");i.default.use(_.a),i.default.config.productionTip=!1,new i.default({el:"#app",router:v,components:{App:o},template:"<App/>"})},huGD:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.35b2a0c99ccfcbf28c7f.js.map